{% extends "main/base.html" %}
{% load static %}
{% block title %}
    TONEOP | Products
{% endblock title %}
{% block body %}
    <body class="color-light ">
        <!-- loader Start -->
        <div id="loading">
            <div id="loading-center"></div>
        </div>
        <!-- loader END -->
        <!-- Wrapper Start -->
        <div class="wrapper">
            <div class="content-page">
                <!-- Message From View -->
                {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                            <li class="alert alert-primary" role="alert">
                                <div class="iq-alert-text">{{ message }}</div>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <div class="container-fluid">
                    <!-- Table -->
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between">
                                    <div class="header-title">
                                        <h4 class="card-title">Products</h4>
                                    </div>
                                    {% if 'ADPR' in request.session.permission_codes %}
                                        <button type="button"
                                                class="btn btn-primary mt-2"
                                                class="btn btn-primary rounded-pill mt-2 mr-2"
                                                data-toggle="modal"
                                                data-target="#Add-Product">
                                            Add Product
                                        </button>
                                    {% endif %}
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table id="datatable1" class="table data-tables table-striped">
                                            <thead>
                                                <tr class="ligth">
                                                    <th>Model No./Name</th>
                                                    <th>Device Type</th>
                                                    <th>Brand</th>
                                                    <th>Service Tag</th>
                                                    <th>Assigned</th>
                                                    <th>Location</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for product in data %}
                                                    <tr>
                                                        <td>{{ product.model_no }}</td>
                                                        <td>{{ product.dev_type }}</td>
                                                        <td>{{ product.brand }}</td>
                                                        <td>{{ product.service_tag }}</td>
                                                        <td>{{ product.assigned }}</td>
                                                        <td>{{ product.loc }}</td>
                                                        <td>
                                                            <div class="d-flex align-items-center list-action">
                                                                <button type="button"
                                                                        class="btn btn-primary rounded-pill mt-2 mr-2"
                                                                        onClick="showProduct({{ product.id }})"
                                                                        data-toggle="modal"
                                                                        data-target="#Show-Product">
                                                                    <i class="ri-eye-line mr-0"></i>
                                                                </button>
                                                                {% if 'EDPR' in request.session.permission_codes %}
                                                                    <button type="button"
                                                                            class="btn btn-success rounded-pill mt-2 mr-2"
                                                                            onClick="editProduct({{ product.id }})"
                                                                            data-toggle="modal"
                                                                            data-target="#Edit-Product">
                                                                        <i class="ri-pencil-line mr-0"></i>
                                                                    </button>
                                                                {% endif %}
                                                                {% if 'DEPR' in request.session.permission_codes %}
                                                                    <button type="button"
                                                                            class="btn btn-secondary rounded-pill mt-2"
                                                                            onClick="deleteProduct({{ product.id }})"
                                                                            data-toggle="modal"
                                                                            data-target="#Delete-Product">
                                                                        <i class="ri-delete-bin-line mr-0"></i>
                                                                    </button>
                                                                {% endif %}
                                                            </div>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Show Modal -->
                    <div class="modal fade"
                         id="Show-Product"
                         tabindex="-1"
                         role="dialog"
                         aria-labelledby="exampleModalCenterTitle"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLongTitle">Show Product</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form data-toggle="validator">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>Device Type *</label>
                                                    <select class="select2 selectpicker form-control"
                                                            name="show_device_type"
                                                            data-style="py-0">
                                                        {% for dev_type in device_type_objs %}
                                                            <option value="{{ dev_type.id }}">
                                                                {{ dev_type.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Model No *</label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Model No"
                                                           id="show_model_no"
                                                           data-errors="Please Enter Model No."
                                                           required>
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Service Tag *</label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Service Tag"
                                                           id="show_service_tag"
                                                           data-errors="Please Enter Service Tag."
                                                           required>
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>Brand *</label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Brand"
                                                           id="show_brand"
                                                           data-errors="Please Enter Brand."
                                                           required>
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        RAM *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter RAM"
                                                           id="show_ram"
                                                           data-errors="Please Enter RAM."
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Memory *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Memory"
                                                           id="show_memory"
                                                           data-errors="Please Enter Memory."
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Assigned *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Assigned"
                                                           id="show_assigned"
                                                           data-errors="Please Enter Name."
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Location *
                                                    </label>
                                                    <select name="show_location"
                                                            class="select2 selectpicker form-control"
                                                            data-style="py-0">
                                                        {% for loc in location_objs %}
                                                            <option value="{{ loc.id }}">
                                                                {{ loc.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Additional Comments
                                                    </label>
                                                    <textarea class="form-control" rows="4" id="show_additional_comments"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Add Modal -->
                    <div class="modal fade"
                         id="Add-Product"
                         tabindex="-1"
                         role="dialog"
                         aria-labelledby="exampleModalCenterTitle"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLongTitle">
                                        Add Product
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form action="add_product_data" data-toggle="validator" method="post">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Device Type *
                                                    </label>
                                                    <select class="select2 selectpicker form-control"
                                                            name="add_device_type"
                                                            data-style="py-0">
                                                        {% for dev_type in device_type_objs %}
                                                            <option value="{{ dev_type.id }}">
                                                                {{ dev_type.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Model No *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Model No"
                                                           id="add_model_no"
                                                           data-errors="Please Enter Model No."
                                                           name="add_model_no"
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Service Tag *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Service Tag"
                                                           id="add_service_tag"
                                                           data-errors="Please Enter Service Tag."
                                                           name="add_service_tag"
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Brand *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Brand"
                                                           id="add_brand"
                                                           data-errors="Please Enter Brand."
                                                           name="add_brand"
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        RAM *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter RAM"
                                                           id="add_ram"
                                                           data-errors="Please Enter RAM."
                                                           name="add_ram"
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Memory *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Memory"
                                                           id="add_memory"
                                                           data-errors="Please Enter Memory."
                                                           name="add_memory"
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Assigned *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Assigned"
                                                           id="add_assigned"
                                                           data-errors="Please Enter Name."
                                                           name="add_assigned"
                                                           required>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Location *
                                                    </label>
                                                    <select name="add_location"
                                                            class="select2 selectpicker form-control"
                                                            data-style="py-0">
                                                        {% for loc in location_objs %}
                                                            <option value="{{ loc.id }}">
                                                                {{ loc.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Additional Comments
                                                    </label>
                                                    <textarea class="form-control"
                                                              rows="4"
                                                              id="add_additional_comments"
                                                              name="add_additional_comments"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary mr-2">
                                                Add Product
                                            </button>
                                            <button type="reset" class="btn btn-danger">
                                                Reset
                                            </button>
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                Close
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Edit Modal -->
                    <div class="modal fade"
                         id="Edit-Product"
                         tabindex="-1"
                         role="dialog"
                         aria-labelledby="exampleModalCenterTitle"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLongTitle">
                                        Edit Product
                                    </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true"> &times; </span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form action="{% url 'edit_product_data' %}"
                                          data-toggle="validator"
                                          method="post">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Device Type *
                                                    </label>
                                                    <input type="hidden" name="edit_id" id="edit_id"/>
                                                    <select class="select2 selectpicker form-control"
                                                            name="edit_device_type"
                                                            data-style="py-0">
                                                        {% for dev_type in device_type_objs %}
                                                            <option value="{{ dev_type.id }}">
                                                                {{ dev_type.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Model No *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Model No"
                                                           id="edit_model_no"
                                                           data-errors="Please Enter Model No."
                                                           name="edit_model_no"
                                                           required/>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Service Tag *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Service Tag"
                                                           id="edit_service_tag"
                                                           data-errors="Please Enter Service Tag."
                                                           name="edit_service_tag"
                                                           required/>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Brand *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Brand"
                                                           id="edit_brand"
                                                           data-errors="Please Enter Brand."
                                                           name="edit_brand"
                                                           required/>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        RAM *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter RAM"
                                                           id="edit_ram"
                                                           data-errors="Please Enter RAM."
                                                           name="edit_ram"
                                                           required/>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Memory *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Memory"
                                                           id="edit_memory"
                                                           data-errors="Please Enter Memory."
                                                           name="edit_memory"
                                                           required/>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label>
                                                        Assigned *
                                                    </label>
                                                    <input type="text"
                                                           class="form-control"
                                                           placeholder="Enter Assigned"
                                                           id="edit_assigned"
                                                           data-errors="Please Enter Name."
                                                           name="edit_assigned"
                                                           required/>
                                                    <div class="help-block with-errors">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Location *
                                                    </label>
                                                    <select name="edit_location"
                                                            class="select2 selectpicker form-control"
                                                            data-style="py-0">
                                                        {% for loc in location_objs %}
                                                            <option value="{{ loc.id }}">
                                                                {{ loc.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label>
                                                        Additional Comments
                                                    </label>
                                                    <textarea class="form-control"
                                                              rows="4"
                                                              id="edit_additional_comments"
                                                              name="edit_additional_comments"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary mr-2">
                                                Update
                                            </button>
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                Close
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Delete-Modal -->
                    <div class="modal fade"
                         id="Delete-Product"
                         tabindex="-1"
                         role="dialog"
                         aria-labelledby="exampleModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <form method="post" action="{% url 'delete_product' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="delete_id" id="delete_id"/>
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">
                                            Delete Product
                                        </h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete this Product's record?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" class="btn btn-secondary" data-dismiss="modal">
                                            Close
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Delete
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
{% endblock body %}
{% block jquery %}
    <script>
        $(document).ready(function() {
            document.getElementById('product').className = "iq-submenu expand";
            document.getElementById('list_product').className = "font-weight-bold active";
        });
    </script>
    <!-- Show Product Functionality -->
    <script>
        function showProduct(id) {
            if (id) {
                $.ajax({
                    url: `get_product_detail/${id}`,
                    type: 'get',
                    async: false,
                    cache: false,
                    success: function(data) {
                        console.log(data)
                        $('#show_id').val(data[0]['id']);
                        $('#show_model_no').val(data[0]['model_no']);
                        $('select[name=show_device_type]').val(data[0]['dev_type_id']);
                        $('.selectpicker').selectpicker('refresh');
                        $('select[name=show_location]').val(data[0]['loc_id']);
                        $('.selectpicker').selectpicker('refresh');
                        $('#show_brand').val(data[0]['brand']);
                        $('#show_service_tag').val(data[0]['service_tag']);
                        $('#show_assigned').val(data[0]['assigned']);
                        $('#show_ram').val(data[0]['ram']);
                        $('#show_memory').val(data[0]['memory']);
                        $('#show_additional_comments').val(data[0]['additional_comments']);
                    }
                });
            }
        }
    </script>
    <!-- Delete Product Functionality -->
    <script>
        function deleteProduct(id) {
            $('#delete_id').val(id);
        }
    </script>
    <!-- Edit Product Functionality -->
    <script>
        function editProduct(id) {
            if (id) {
                $.ajax({
                    url: `get_product_detail/${id}`,
                    type: 'get',
                    async: false,
                    cache: false,
                    success: function(data) {
                        console.log(data)
                        $('#edit_id').val(data[0]['id']);
                        $('#edit_model_no').val(data[0]['model_no']);
                        $('select[name=edit_device_type]').val(data[0]['dev_type_id']);
                        $('.selectpicker').selectpicker('refresh');
                        $('select[name=edit_location]').val(data[0]['loc_id']);
                        $('.selectpicker').selectpicker('refresh');
                        $('#edit_brand').val(data[0]['brand']);
                        $('#edit_service_tag').val(data[0]['service_tag']);
                        $('#edit_assigned').val(data[0]['assigned']);
                        $('#edit_ram').val(data[0]['ram']);
                        $('#edit_memory').val(data[0]['memory']);
                        $('#edit_additional_comments').val(data[0]['additional_comments']);
                    }
                });
            }
        }
    </script>
{% endblock jquery %}
